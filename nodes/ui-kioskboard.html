<script type="text/javascript">
    RED.nodes.registerType('ui-kioskboard', {
        category: 'andor',
        color: '#a6bbcf',
        defaults: {
            name: { value: "" },
            group: { type: 'ui-group', required: true },
            order: { value: 0 },      
            width: {
                value: 0,
                validate: function (v) {
                    const width = v || 0
                    const currentGroup = $('#node-input-group').val() || this.group
                    const groupNode = RED.nodes.node(currentGroup)
                    const valid = !groupNode || +width <= +groupNode.width
                    $('#node-input-size').toggleClass('input-error', !valid)
                    return valid
                }
            },
            height: { value: 0 },
            label: { value: 'label' },
            gap: { value: '4' },
            topic: { value: null },
            scale: { value: '1' },
            keysArrayOfObjects: { value: 
`[
 {"0": "Q", "1": "W", "2": "E", "3": "R", "4": "T", "5": "Y", "6": "U", "7": "I", "8": "O", "9": "P", "10": "Å"},
 {"0": "A", "1": "S", "2": "D", "3": "F", "4": "G", "5": "H", "6": "J", "7": "K", "8": "L", "9": "Ö", "10": "Ä"},
 {"0": "Z", "1": "X", "2": "C", "3": "V", "4": "B", "5": "N", "6": "M", "7": ",", "8": ".", "9": "-"}
]` },
            keysSpecialCharsArrayOfStrings: { value: null },
            keysNumpadArrayOfNumbers: { value: null },
            dataKioskboardType: { value: 'all' },
            dataKioskboardSpecialcharacters: {value: true },
            theme: { value: "light" },
            autoScroll: { value: true },
            capsLockActive: { value: true },
            allowRealKeyboard: { value: false },
            allowMobileKeyboard: { value: false },
            cssAnimations: { value: true },
            cssAnimationsDuration: { value: 360 },
            cssAnimationsStyle: { value: "slide" },
            keysAllowSpacebar: { value: true },
            keysSpacebarText: { value: "Space" },
            keysFontFamily: { value: "sans-serif" },
            keysFontSize: { value: "22px" },
            keysFontWeight: { value: "normal" },
            keysIconSize: { value: "25px" },
            keysEnterText: { value: "Enter" },
            keysEnterCanClose: { value: true }
        },
        inputs: 1,
        outputs: 1,
        icon: "font-awesome/fa-keyboard-o",
        paletteLabel: 'kioskboard',
        label: function() { return this.name || "kioskboard"; },
        labelStyle: function () { return this.name ? 'node_label_italic' : '' },
        oneditprepare: function () {
            const tabs = RED.tabs.create({
                id: 'node-kiosk-tabs',
                onchange: function (tab) {
                    $('#node-kiosk-tabs-content').children().hide();
                    $('#' + tab.id).show();
                }
            });
            tabs.addTab({
                id: 'node-kiosk-tabs-main',
                label: 'Main'
            });
            tabs.addTab({
                id: 'node-kiosk-tabs-keys',
                label: 'Keys'
            });
            $('#node-input-size').elementSizer({
                width: '#node-input-width',
                height: '#node-input-height',
                group: '#node-input-group'
            });
        },
    });
</script>

<script type="text/html" data-template-name="ui-kioskboard">
    <div class="form-row func-tabs-row">
        <ul style="min-width: 250px; margin-bottom: 20px;" id="node-kiosk-tabs"></ul>
    </div>

    <div id="node-kiosk-tabs-content">
        <div id="node-kiosk-tabs-main" style="display: none;">
            <div class="form-row">
                <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
                <input type="text" id="node-input-name" placeholder="Name">
            </div>
            <div class="form-row">
                <label for="node-input-group"><i class="fa fa-table"></i> Group</label>
                <input type="text" id="node-input-group">
            </div>
            <div class="form-row">
                <label><i class="fa fa-object-group"></i> Size</label>
                <input type="hidden" id="node-input-width">
                <input type="hidden" id="node-input-height">
                <button class="editor-button" id="node-input-size"></button>
            </div>
            <div class="form-row">
                <label for="node-input-topic"><i class="fa fa-envelope-o"></i> Topic</label>
                <input type="text" id="node-input-topic">
            </div>
            <div class="form-row">
                <label for="node-input-label"><i class="fa fa-tag"></i> Label</label>
                <input type="text" id="node-input-label" placeholder="label">
            </div>
            <div class="form-row">
                <label for="node-input-scale">
                    <i class="fa fa-expand"></i> Scale
                </label>
                <input type="number" id="node-input-scale" step="0.01" placeholder="1">
            </div>
            <div class="form-row">
                <label for="node-input-dataKioskboardType">Type</label>
                <select id="node-input-dataKioskboardType">
                    <option selected value="all">All</option>
                    <option value="keyboard">Keyboard</option>
                    <option value="numpad">Numpad</option>
                </select>
            </div>
            <div class="form-row">
                <label for="node-input-dataKioskboardSpecialcharacters"><i class="fa fa-paragraph"></i> Special</label>
                <input type="checkbox" id="node-input-dataKioskboardSpecialcharacters" style="width: auto">
            </div>
            <div class="form-row">
                <label for="node-input-theme"><i class="fa fa-paint-brush"></i> Theme</label>
                <select id="node-input-theme">
                    <option selected value="light">Light</option>
                    <option value="dark">Dark</option>
                    <option value="flat">Flat</option>
                    <option value="material">Material</option>
                    <option value="oldschool">Oldschool</option>
                </select>
            </div>
            <div class="form-row">
                <label for="node-input-gap"><i class="fa fa-arrows-h"></i> Gap</label>
                <input type="number" id="node-input-gap">
            </div>
            <div class="form-row">
                <label for="node-input-autoScroll"><i class="fa fa-arrows-v"></i> Autoscroll</label>
                <input type="checkbox" id="node-input-autoScroll" style="width: auto">
            </div>
            <div class="form-row">
                <label for="node-input-capsLockActive"><i class="fa fa-arrow-up"></i> CapsLock</label>
                <input type="checkbox" id="node-input-capsLockActive" style="width: auto">
            </div>
            <div class="form-row">
                <label for="node-input-allowRealKeyboard"><i class="fa fa-keyboard-o"></i> Keyboard</label>
                <input type="checkbox" id="node-input-allowRealKeyboard" style="width: auto">
            </div>
            <div class="form-row">
                <label for="node-input-allowMobileKeyboard"><i class="fa fa-mobile"></i> Mobile</label>
                <input type="checkbox" id="node-input-allowMobileKeyboard" style="width: auto">
            </div>
            <div class="form-row">
                <label for="node-input-cssAnimations"><i class="fa fa-spinner"></i> Animate</label>
                <input type="checkbox" id="node-input-cssAnimations" style="width: auto">
            </div>
            <div class="form-row">
                <label for="node-input-cssAnimationsDuration"><i class="fa fa-clock-o"></i> Duration</label>
                <input type="number" id="node-input-cssAnimationsDuration">
            </div>
            <div class="form-row">
                <label for="node-input-cssAnimationsStyle">Animation</label>
                <select id="node-input-cssAnimationsStyle">
                    <option selected value="slide">Slide</option>
                    <option value="fade">Fade</option>
                </select>
            </div>
            <div class="form-row">
                <label for="node-input-keysAllowSpacebar"><i class="fa fa-keyboard-o"></i> Spacebar</label>
                <input type="checkbox" id="node-input-keysAllowSpacebar" style="width: auto">
            </div>
            <div class="form-row">
                <label for="node-input-keysSpacebarText"><i class="fa fa-keyboard-o"></i> Spacebar text</label>
                <input type="text" id="node-input-keysSpacebarText" placeholder='Space'>
            </div>
            <div class="form-row">
                <label for="node-input-keysFontFamily"><i class="fa fa-font"></i> Font</label>
                <input type="text" id="node-input-keysFontFamily" placeholder='sans-serif'>
            </div>
            <div class="form-row">
                <label for="node-input-keysFontSize"><i class="fa fa-text-height"></i> Fontsize</label>
                <input type="text" id="node-input-keysFontSize" placeholder='22px'>
            </div>
            <div class="form-row">
                <label for="node-input-keysFontWeight"><i class="fa fa-bold"></i> Fontweight</label>
                <input type="text" id="node-input-keysFontWeight" placeholder='normal'>
            </div>
            <div class="form-row">
                <label for="node-input-keysIconSize"><i class="fa fa-smile-o"></i> Iconsize</label>
                <input type="text" id="node-input-keysIconSize" placeholder='25px'>
            </div>
            <div class="form-row">
                <label for="node-input-keysEnterText"><i class="fa fa-keyboard-o"></i> Return text</label>
                <input type="text" id="node-input-keysEnterText" placeholder='Enter'>
            </div>
            <div class="form-row">
                <label for="node-input-keysEnterCanClose"><i class="fa fa-times-circle"></i> Close on return</label>
                <input type="checkbox" id="node-input-keysEnterCanClose" style="width: auto">
            </div>
        </div>

        <div id="node-kiosk-tabs-keys" style="display: none;">
            <div class="form-row">
                <label for="node-input-keysArrayOfObjects"><i class="fa fa-keyboard-o"></i> Keys JSON</label>
                <textarea id="node-input-keysArrayOfObjects" rows="10" placeholder='[{"0":"1","1":"2","2":"3"}]'></textarea>
            </div>
            <div class="form-row">
                <label for="node-input-keysSpecialCharsArrayOfStrings"> Special characters JSON</label>
                <input type="text" id="node-input-keysSpecialCharsArrayOfStrings" placeholder='["#", "€", "%", "+", "-", "*"]'>
            </div>
            <div class="form-row">
                <label for="node-input-keysNumpadArrayOfNumbers"> Numpad keys JSON</label>
                <input type="text" id="node-input-keysNumpadArrayOfNumbers" placeholder='[1, 2, 3, 4, 5, 6, 7, 8, 9, 0]'>
            </div>
        </div>
    </div>
</script>

<style>
    #node-kiosk-tabs-keys textarea {
        width: 100%;
        box-sizing: border-box;
        font-family: monospace;
    }
</style>

<script type="text/markdown" data-help-name="ui-kioskboard">

This widget provides a text input field with an on-screen keyboard powered by furcan KioskBoard.

### Main

**Topic** -
Defines the `msg.topic`.

If the Topic is blank no `msg.topic` will be sent.

Note: this Topic will be overwritten if any input `msg.topic` arrive.

**Label** -
Set the input label text. Also sets the placeholder text of the input field.

**Scale** -
Factor to multiply the entered value before sending.

**Type** -
Select the type of keyboard.

Avaliable options:
- all — Standard keys and numpad (default)
- keyboard — Keys only
- numpad — Numpad only

**Special** -
Displays a button to open the special characters keyboard.

**Theme** -
Select the visual style of the keyboard.

Available options:
- light — Light theme (default)
- dark — Dark mode
- flat — Minimal flat design
- material — Material-style design
- oldschool — Classic button look

**Gap** -
Defines the gap between the input label and the input field.

Must have a value between 1 and 12.

**Autoscroll** -
Enable scroll into view when opened on smaller screens.

**CapsLock** -
Enable start with uppercase letters.

**Keyboard** -
Allow use of a physical (hardware) keyboard. 

**Mobile** -
Allow on-screen keyboard provided by the mobile device.

**Animate** -
Enable animated transitions.

**Duration** -
Set the duration of the animated transition.

**Animation** -
Select the CSS animation used when opening or closing the keyboard.

Available options:
- slide — Slides in and out. (default)
- fade — Fades in and out.

**Spacebar** -
Allow use of the spacebar.

**Spacebar text** -
Define the spacebar label. Use a blank `" "` to use an empty space label.

**Font** -
Define the font family of the keys.

**Fontsize** -
Define the font size of the keys.

**Fontweight** -
Define the font weight of the keys. Weight can be specified using keyword values 
or numeric values ranging from 100 to 900.

Keyword values
- normal — Defines normal characters (default).
- bold — Defines thick characters.
- bolder — Defines thicker characters relative to the parent element.
- lighter — Defines lighter characters relative to the parent element.

Numeric values (range from 100 to 900) example:
- 400 — equivalent to normal.
- 700 — equivalent to bold.

**Iconsize** -
Define the size of the icon keys.

**Return text** -
Define the return key label. Use a blank `" "` to use an empty return key label.

**Close on return** -
Define if the Enter key can close and remove the keyboard.

---

### Keys
Define the keyboard layout.

**Keys JSON (mandatory)** -
Defines the keyboard layout.

Must be a valid JSON array of row objects.

Example:
```json
[
  {"0": "A", "1": "B", "2": "C"},
  {"0": "D", "1": "E", "2": "F"},
  {"0": "G", "1": "H", "2": "I"},
  {"0": "J", "1": "K", "2": "L"}
]
```

**Special Characters (optional)** -
Override the built-in special characters.

Example:
```json
["#", "€", "%", "+", "-", "*"]
```

**Numpad keys JSON (optional)** -
Override the built-in numpad keys.

Example:
```
[1, 2, 3, 4, 5, 6, 7, 8, 9, 0]
```
</script>